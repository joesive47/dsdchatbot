<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - DSD Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn-logout {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            text-decoration: none;
            transition: background 0.3s;
        }

        .btn-logout:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .admin-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .admin-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .admin-card:hover {
            transform: translateY(-5px);
        }

        .admin-card h3 {
            color: #333;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: transform 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .file-upload-area {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background: #f8f9ff;
            margin: 1rem 0;
            cursor: pointer;
            transition: background 0.3s;
        }

        .file-upload-area:hover {
            background: #f0f4ff;
        }

        .file-upload-area.dragover {
            background: #e8f0fe;
            border-color: #4285f4;
        }

        .quick-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .railway-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .sample-data {
            background: #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.8rem;
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .admin-sections {
                grid-template-columns: 1fr;
            }

            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .quick-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <h1>‚öôÔ∏è Admin Dashboard</h1>
            <div class="user-info">
                <span>üë§ Admin User</span>
                <a href="/logout" class="btn-logout">üö™ Logout</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Railway Status -->
        <div class="railway-info">
            <h3>üöÇ Railway Platform Status</h3>
            <p>‚úÖ System Online ‚Ä¢ üîÑ Auto-deploy Active ‚Ä¢ üåè Global CDN</p>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-success">
                        ‚úÖ {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Dashboard Stats -->
        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-number" id="totalQuestions">{{ total_questions or 0 }}</div>
                <div class="stat-label">üìù Total Questions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCategories">{{ total_categories or 0 }}</div>
                <div class="stat-label">üìÅ Categories</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">24/7</div>
                <div class="stat-label">üöÇ Railway Uptime</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">0ms</div>
                <div class="stat-label">‚ö° Cold Start Time</div>
            </div>
        </div>

        <!-- Admin Sections -->
        <div class="admin-sections">
            <!-- Add Category -->
            <div class="admin-card">
                <h3>üìÅ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà</h3>
                <form method="POST" action="/add_category">
                    <div class="form-group">
                        <label for="category_name">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</label>
                        <input type="text" 
                               class="form-control" 
                               id="category_name" 
                               name="category_name" 
                               placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏£‡∏≤‡∏Ñ‡∏≤, ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠"
                               required>
                    </div>
                    <button type="submit" class="btn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</button>
                </form>

                <div class="sample-data">
                    <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</strong><br>
                    ‚Ä¢ ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ<br>
                    ‚Ä¢ ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô<br>
                    ‚Ä¢ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô<br>
                    ‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
                </div>
            </div>

            <!-- Upload Excel -->
            <div class="admin-card">
                <h3>üìä Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Excel</h3>
                <form method="POST" action="/upload_excel" enctype="multipart/form-data" id="uploadForm">
                    <div class="form-group">
                        <label for="category_id">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</label>
                        <select class="form-control" name="category_id" required>
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà --</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}">{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="file-upload-area" id="fileUploadArea">
                        <div>üìÅ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
                        <input type="file" 
                               name="file" 
                               accept=".xlsx,.xls" 
                               style="display: none;" 
                               id="fileInput" 
                               required>
                        <div id="fileName" style="margin-top: 10px; font-weight: bold; color: #667eea;"></div>
                    </div>

                    <button type="submit" class="btn">üì§ Upload Excel</button>
                    <a href="/download_template" class="btn btn-secondary">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template</a>
                </form>

                <div class="sample-data">
                    <strong>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå Excel:</strong><br>
                    | question | answer |<br>
                    | ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ | ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! |<br>
                    | ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á | ‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≠‡∏£‡πå‡∏™... |
                </div>
            </div>

            <!-- Add Single Question -->
            <div class="admin-card">
                <h3>‚ùì ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß</h3>
                <form method="POST" action="/add_question">
                    <div class="form-group">
                        <label for="question_category">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</label>
                        <select class="form-control" name="category_id" required>
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà --</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}">{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="question">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</label>
                        <input type="text" 
                               class="form-control" 
                               name="question" 
                               placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà"
                               required>
                    </div>

                    <div class="form-group">
                        <label for="answer">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:</label>
                        <textarea class="form-control" 
                                  name="answer" 
                                  rows="4" 
                                  placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô 2,500 ‡∏ö‡∏≤‡∏ó..."
                                  required></textarea>
                    </div>

                    <button type="submit" class="btn">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</button>
                </form>
            </div>

            <!-- Quick Actions -->
            <div class="admin-card">
                <h3>‚ö° Quick Actions</h3>
                <div class="quick-actions">
                    <a href="/questions" class="btn">üìã ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</a>
                    <a href="/api/stats" class="btn btn-secondary">üìä ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</a>
                    <a href="/export_questions" class="btn btn-success">üì§ Export CSV</a>
                    <a href="/api/health" class="btn btn-secondary">üîç API Status</a>
                </div>

                <div style="margin-top: 1.5rem;">
                    <h4>üöÇ Railway Commands:</h4>
                    <div class="sample-data">
                        ‚Ä¢ Auto-deploy: ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà push GitHub<br>
                        ‚Ä¢ Logs: ‡∏î‡∏π‡πÑ‡∏î‡πâ‡πÉ‡∏ô Railway Dashboard<br>
                        ‚Ä¢ Scale: ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏° traffic<br>
                        ‚Ä¢ Database: PostgreSQL ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                    </div>
                </div>
            </div>

            <!-- System Info -->
            <div class="admin-card">
                <h3>üñ•Ô∏è System Information</h3>
                <div class="sample-data">
                    <strong>üöÇ Railway Info:</strong><br>
                    Platform: Railway Cloud<br>
                    Region: Asia Southeast<br>
                    Auto-deploy: ‚úÖ Active<br>
                    SSL/HTTPS: ‚úÖ Enabled<br>
                    <br>
                    <strong>üêç Python Info:</strong><br>
                    Flask: Latest<br>
                    Database: SQLite/PostgreSQL<br>
                    CORS: ‚úÖ Enabled<br>
                    <br>
                    <strong>üì° API Endpoints:</strong><br>
                    ‚Ä¢ GET /api/health<br>
                    ‚Ä¢ POST /api/chat<br>
                    ‚Ä¢ GET /api/stats<br>
                </div>

                <div class="quick-actions">
                    <button onclick="testAPI()" class="btn">üß™ Test API</button>
                    <button onclick="refreshStats()" class="btn btn-secondary">üîÑ Refresh Stats</button>
                </div>
                
                <div id="apiTestResult" style="margin-top: 1rem;"></div>
            </div>

            <!-- Database Management -->
            <div class="admin-card">
                <h3>üóÑÔ∏è Database Management</h3>
                <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°-‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</p>
                
                <div class="quick-actions">
                    <a href="/questions" class="btn">üìù Edit Questions</a>
                    <button onclick="backupData()" class="btn btn-secondary">üíæ Backup</button>
                    <button onclick="clearLogs()" class="btn btn-danger">üóëÔ∏è Clear Logs</button>
                </div>

                <div style="margin-top: 1rem;">
                    <small>‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Railway:</small>
                    <div class="sample-data">
                        ‚Ä¢ Free tier: 500h/month<br>
                        ‚Ä¢ Database: PostgreSQL ‡∏ü‡∏£‡∏µ<br>
                        ‚Ä¢ Traffic: Unlimited<br>
                        ‚Ä¢ Storage: 1GB
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // File upload handling
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');

        fileUploadArea.addEventListener('click', () => fileInput.click());

        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('dragover');
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                fileName.textContent = `üìÅ Selected: ${files[0].name}`;
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                fileName.textContent = `üìÅ Selected: ${e.target.files[0].name}`;
            }
        });

        // API Testing
        async function testAPI() {
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.innerHTML = '<p style="color: #667eea;">üîÑ Testing API...</p>';
            
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; color: #155724; padding: 10px; border-radius: 5px;">
                            <strong>‚úÖ API Test Success!</strong><br>
                            Status: ${data.status}<br>
                            Environment: ${data.environment || 'Unknown'}<br>
                            No Cold Start: ${data.railway_info?.no_cold_start ? '‚úÖ' : '‚ùå'}
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px;">
                        <strong>‚ùå API Test Failed!</strong><br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        // Refresh Stats
        async function refreshStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('totalQuestions').textContent = data.total_questions || 0;
                    document.getElementById('totalCategories').textContent = data.total_categories || 0;
                    
                    alert('‚úÖ Stats refreshed successfully!');
                } else {
                    alert('‚ùå Failed to refresh stats');
                }
            } catch (error) {
                alert('‚ùå Error: ' + error.message);
            }
        }

        // Backup Data
        function backupData() {
            if (confirm('üíæ Export all questions as CSV backup?')) {
                window.location.href = '/export_questions';
            }
        }

        // Clear Logs (placeholder)
        function clearLogs() {
            if (confirm('üóëÔ∏è Clear application logs? This cannot be undone.')) {
                alert('‚ÑπÔ∏è Log clearing not implemented in demo version');
            }
        }

        // Auto-refresh stats every 5 minutes
        setInterval(refreshStats, 300000);

        // Console info
        console.log('‚öôÔ∏è Admin Dashboard Loaded');
        console.log('üöÇ Railway Platform Active');
        console.log('üìä Auto-refresh: Every 5 minutes');
        console.log('üîß Available functions: testAPI(), refreshStats(), backupData()');
    </script>
</body>
</html>